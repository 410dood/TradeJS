<div modalAnchor></div>
<app-alert></app-alert>

<nav [ngClass]="{visible: !router.url.startsWith('/login') && !router.url.startsWith('/register')}" class="nav-main" id="sidebar" #navbar>
    <a [routerLink]="['/user/', userService.model.options._id]" [routerLinkActive]="['active']" class="profile">
        <img class="logo" width="70" height="70" [attr.src]="userService.model.options.img ? userService.model.options.img : undefined">
        <h4>{{userService.model.options.name || '&nbsp;'}}</h4>
    </a>
    <!-- <a [routerLink]="['/portfolio']" [routerLinkActive]="['active']">
            <i class="fa fa-handshake-o"></i>
            <span>Portfolio</span>
        </a> -->
    <a [routerLink]="['/news']" [routerLinkActive]="['active']">
        <i class="fa fa-newspaper-o"></i>
        <span>News feed</span>
    </a>
    <a [routerLink]="['/calendar']" [routerLinkActive]="['active']">
        <i class="fa fa-calendar"></i>
        <span>Calender</span>
    </a>
    <a [routerLink]="['/user']" [routerLinkActive]="['active']">
        <i class="fa fa-users"></i>
        <span>Users</span>
    </a>
    <a [routerLink]="['/charts']" [routerLinkActive]="['active']">
        <i class="fa fa-bar-chart"></i>
        <span>Stocks</span>
    </a>
    <!-- <a [routerLink]="['/backtest']" [routerLinkActive]="['active']">
            <i class="fa fa-flash"></i>
            <span>Backtest</span>
        </a> -->
    <a [routerLink]="['/editor']" [routerLinkActive]="['active']">
        <i class="fa fa-code"></i>
        <span>Editor</span>
    </a>
    <a [routerLink]="['/settings']" [routerLinkActive]="['active']">
        <i class="fa fa-gears"></i>
        <span>Settings</span>
    </a>
    <a (click)="logout()">
        <i class="fa fa-sign-out"></i>
        <span>Logout</span>
    </a>

</nav>

<div (click)="onClickOverlay()" class="nav-overlay"></div>

<main class="main-container">
    <header [ngClass]="{visible: !router.url.startsWith('/login') && !router.url.startsWith('/register')}">
        <i (click)="toggleNav($event)" class="fa fa-navicon hidden-lg-up"></i>
        <i  *ngIf="router.url.startsWith('/charts') || ['/user'].includes(router.url)" (click)="onClickFilter($event)" class="fa fa-filter hidden-lg-up"></i>
        
        <div class="header-search">
            <input (keyup)="onSearchKeyUp($event)" (focus)="onSearchKeyUp($event)" placeholder="Markets / People" #input>
            <div class="search-drop-down" *ngIf="(searchResults$ | async) as result" (click)="onClickDropdownItem()" #dropdown>
                <a *ngFor="let symbol of result.symbols" [routerLink]="['/charts']" [queryParams]="{symbol: symbol.options.name}">
                    <img src="{{symbol.options.img}}">
                    <span>{{symbol.options.displayName}}</span>
                </a>
                <a *ngFor="let user of result.users" [routerLink]="['/user/', user._id]">
                    <img src="{{user.img}}">
                    <span>{{user.name}}</span>
                </a>
            </div>
        </div>
    </header>
    <router-outlet></router-outlet>
</main>